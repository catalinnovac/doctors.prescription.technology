<!DOCTYPE html>
<html>
	<head>
		<title>Prescription Technology</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/reset.css" media="screen" />
		<link rel="stylesheet" type="text/css" href="css/responsive.gs.24col.css" media="screen" />
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="css/styles.css" media="screen" />
		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="js/respond.min.js"></script>
		<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="js/custom.jquery.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,800,700italic" rel="stylesheet" type="text/css" />
	</head>
	<body id="index">
		<!-- Preloader -->
		<div id="page-preloader">
			<img class="preloader" src="img/loading.gif" alt=""/>
		</div>
		
		<div class="container wrap">
			<div class="row gutters">
				<div class="col span_24">
					<a href="/" id="logo" title="Prescription Technology - Doctors Interface" /><img src="img/logo_PT.png" alt="" /></a>
					<a href="/" id="nav-toggle" title="Prescription Technology - Doctors Interface Menu" />Menu</a>
				</div>
			</div>
			<div class="row gutters">
				<div class="col span_24">
					<h1>History</h1>

				    <div id="history">
				        <div id="clone">
				            <div class="edit-buttons">
				                <a id="edit-link"></a>
				            </div>
				            <div class="customer-placeholder">
				                <div class="customer">
				                    <span id="firstname"></span><span id="middleinitial"></span><span id="lastname"></span>

				                    <p id="email"></p>

				                    <p id="phone"></p>

				                    <p id="shipping_country"></p>
				                </div>
				                <div class="customer-info">
				                    <p id="bmi"></p>

				                    <p id="height"></p>

				                    <p id="weight"></p>

				                    <p id="language"></p>
				                </div>
				            </div>
				            <div class="Treatment_Order">
				                <p id="OrderNumber"></p>

				                <p id="OrderDate"></p>

				                <p id="OrderStatus"></p>
				                <ul id="Meds">
				                    <li class="cloneable"><p id="MedName"></p></li>
				                </ul>
				            </div>
				            <div class="Assign_date">
				                <p id="assign_date"></p>
				            </div>
				        </div>
				    </div>
				</div>
			</div>
		</div>

		<footer class="container wrap">
			<div class="row gutters">
				<div class="col span_12">
					This software and all connected databases are the exclusive property of
					<strong>HR Healthcare Ltd</strong><br>
					All rights are reserved by <strong>HR Healthcare Ltd, The Office, Britannia Way, Waters Meeting, Bolton, BL2
					2HH. 01204 559 999</strong> <br>
					All Intellectual Property Rights belong to <strong>HR Healthcare Ltd, The Office, Britannia Way, Waters Meeting,
					Bolton, BL2 2HH. 01204 559 999</strong>
				</div>
				<div class="col span_12">
					Any use, editing, changing, multiplication or commercial
					use (including but not limited to selling, licensing of this software
					and/or parts of it and/or its connected database information), independent
					of any changes being done first, is prohibited.
				</div>
			</div>
		</footer>

		<script type="text/javascript">
			function PowerUp() {
				$('#nav-toggle').on('touchstart click', function(e){
					e.preventDefault();
                    var extra = new Array();
                    extra.push({ key:"open",value:"1"});
                    doctors.sendMessage("DRAWER",JSON.stringify(extra));
				});

                $.ajax({
                    url: 'http://doctors.prescription.technology/ws/history.asp',
                    type: 'GET',
                    beforeSend: function (xhr) { xhr.setRequestHeader('Authorization', doctors.getToken()); }
                }).fail(function (xhr, textStatus, error) { alert(textStatus); })
                .done(function (data, textStatus, xhr) {
                    //alert(data);
                    var history = JSON.parse(data);
                    if (history.Orders_History.length > 0) {
                        for (var i = 0; i < history.Orders_History.length; i++) {
                            var current_history = history.Orders_History[i];
                            var $clone = $($("#clone").clone(true));
                            $clone.prop("id", "_" + current_history.OrderNumber.oid);
                            $clone.removeClass("cloneable");
                            $clone.find("#edit-link").attr("href", current_history.OrderNumber.oid_url);
                            $clone.find("#firstname").text(current_history.customer.firstname);
                            $clone.find("#middleinitial").text(current_history.customer.middleinitial);
                            $clone.find("#lastname").text(current_history.customer.lastname);
                            $clone.find("#email").text(current_history.customer.email);
                            $clone.find("#phone").text(current_history.customer.phone);
                            $clone.find("#shipping_country").text(current_history.customer.shipping_country);
                            $clone.find("#bmi").text(current_history.customer.bmi);
                            $clone.find("#height").text(current_history.customer.height);
                            $clone.find("#weight").text(current_history.customer.weight);
                            $clone.find("#language").text(current_history.customer.language);
                            $clone.find("#OrderNumber").text(current_history.Treatment.oid);
                            $clone.find("#OrderDate").text(current_history.Treatment.orderdate);
                            $clone.find("#OrderStatus").text(current_history.Treatment.status);
                            for (var j = 0; j < current_history.Treatment.Meds.length ; j++) {
                                var $li = $($clone.find("#Meds").find("li.cloneable").clone(true));
                                $li.find("#MedName").text(current_history.Treatment.Meds[j].MedName)
                                $li.appendTo($clone.find("#Meds"));
                            }
                            $clone.find("#assign_date").text(current_history.Assign_date);
                            $clone.appendTo($('#history'));
                        }
                    } else {
                        $('<p></p>').html("No history yet").appendTo($('#history'));
                    }
                    var extra = new Array();
                    extra.push({ key: "open", value: "0" });
                    doctors.sendMessage("DRAWER", JSON.stringify(extra));
                });
            };
			$(function() {
	            document.addEventListener("deviceready", PowerUp, false);
				
				/* Only for in-browser (not in Android) testing */
				//PowerUp();
			})
	    </script>
	</body>
</html>